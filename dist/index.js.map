{
  "version": 3,
  "sources": ["../src/reactivity/src/dep.ts", "../src/reactivity/src/effect.ts", "../src/shared/shapeFlags.ts", "../src/shared/index.ts", "../src/reactivity/src/baseHandlers.ts", "../src/reactivity/src/reactive.ts", "../main.ts"],
  "sourcesContent": ["export function createDep(effects?) {\r\n    const dep = new Set(effects)\r\n    return dep\r\n}", "import { createDep } from './dep'\r\n\r\nlet activeEffect = void 0\r\nconst targetMap = new WeakMap()\r\n\r\n/**\r\n\r\nobject(\u5F15\u7528): {\r\n    key: dep || createDep() || Set()\r\n}\r\n\r\n\r\n**/\r\n\r\nexport function track(target, type, key) {\r\n    let depsMap = targetMap.get(target)\r\n    if (!depsMap) {\r\n        console.log('\u8BBE\u7F6E')\r\n        depsMap = new Map()\r\n        targetMap.set(target, depsMap)\r\n    }\r\n\r\n    let dep = depsMap.get(key)\r\n\r\n    if (!dep) {\r\n        dep = createDep()\r\n        depsMap.set(key, dep)\r\n    }\r\n\r\n    trackEffects(dep)\r\n}\r\n\r\nexport function trackEffects(dep) {\r\n    if (!activeEffect) return\r\n\r\n    dep.add(activeEffect);\r\n\r\n    (activeEffect as any).deps.push(dep)\r\n}\r\n\r\nexport function isTracking() {\r\n    return activeEffect !== undefined\r\n}\r\n\r\nexport function trigger(target, type, key) {\r\n    let deps: Array<any> = []\r\n\r\n    const depsMap = targetMap.get(target)\r\n\r\n    console.log(targetMap)\r\n\r\n    const dep = depsMap.get(key)\r\n\r\n    deps.push(dep)\r\n\r\n    const effects: Array<any> = []\r\n\r\n    deps.forEach((dep) => {\r\n        effects.push(...dep)\r\n    })\r\n\r\n    triggerEffects(createDep(effects))\r\n}\r\n\r\nexport function triggerEffects(dep) {\r\n    for (const effect of dep) {\r\n        if (effect.scheduler) {\r\n            // scheduler \u53EF\u4EE5\u8BA9\u7528\u6237\u81EA\u5DF1\u9009\u62E9\u8C03\u7528\u7684\u5B9E\u9645\r\n            // \u8FD9\u6837\u5C31\u53EF\u4EE5\u7075\u6D3B\u7684\u63A7\u5236\u8C03\u7528\r\n            // TODO: runtime-core next ticker\r\n            effect.scheduler()\r\n        } else {\r\n            effect.run()\r\n        }\r\n    }\r\n}\r\n\r\n// \u7528\u4E8E\u4F9D\u8D56\u6536\u96C6\r\nexport class ReactiveEffect {\r\n    active = true\r\n    deps = []\r\n    public onStop?: () => void\r\n    constructor(public fn, public scheduler?) {\r\n        console.log('\u521B\u5EFA ReactiveEffect \u5BF9\u8C61')\r\n    }\r\n\r\n    run() {\r\n        // \u6267\u884C\u7684\u65F6\u5019\u7ED9\u5168\u5C40\u7684 activeEffect \u8D4B\u503C\r\n        // \u5229\u7528\u5168\u5C40\u5C5E\u6027\u6765\u83B7\u53D6\u5F53\u524D\u7684 effect\r\n        activeEffect = this as any\r\n        // \u6267\u884C\u7528\u6237\u4F20\u5165\u7684 fn\r\n        console.log('\u6267\u884C\u7528\u6237\u4F20\u5165\u7684 fn')\r\n        return this.fn()\r\n    }\r\n\r\n    stop() {\r\n        if (this.active) {\r\n            // \u5982\u679C\u7B2C\u4E00\u6B21\u6267\u884C stop \u540E active \u5C31 false \u4E86\r\n            // \u4E3A\u4E86\u9632\u6B62\u91CD\u590D\u7684\u8C03\u7528\uFF0C\u6267\u884C stop \u903B\u8F91\r\n            cleanupEffect(this)\r\n            if (this.onStop) {\r\n                // TODO: \u54EA\u91CC\u6765\u4F20\u5165\u8D4B\u503C\u7684 onStop\r\n                this.onStop()\r\n            }\r\n            this.active = false\r\n        }\r\n    }\r\n}\r\n\r\nfunction cleanupEffect(effect: ReactiveEffect) {\r\n    // \u627E\u5230\u6240\u6709\u4F9D\u8D56 \u8FD9\u4E2A effect \u7684\u76F8\u5E94\u5F0F\u5BF9\u8C61\r\n    // \u4ECE\u8FD9\u4E9B\u76F8\u5E94\u5F0F\u5BF9\u8C61\u91CC\u9762\u628A effect \u7ED9\u5220\u9664\u6389\r\n    effect.deps.forEach((dep: Set<ReactiveEffect>) => {\r\n        dep.delete(effect)\r\n    })\r\n    effect.deps.length = 0\r\n}", "// \u7EC4\u4EF6\u7684\u7C7B\u578B\r\nexport const enum ShapeFlags {\r\n    // \u6700\u540E\u8981\u6E32\u67D3\u7684 element \u7C7B\u578B\r\n    ELEMENT = 1,\r\n    // \u7EC4\u4EF6\u7C7B\u578B\r\n    STATEFUL_COMPONENT = 1 << 2,\r\n    // vnode \u7684 children \u4E3A string \u7C7B\u578B\r\n    TEXT_CHILDREN = 1 << 3,\r\n    // vnode \u7684 children \u4E3A\u6570\u7EC4\u7C7B\u578B\r\n    ARRAY_CHILDREN = 1 << 4,\r\n    // vnode \u7684 children \u4E3A slots \u7C7B\u578B\r\n    SLOTS_CHILDREN = 1 << 5\r\n}\r\n", "export * from \"./shapeFlags\";\r\n\r\nexport const isObject = (val) => {\r\n  return val !== null && typeof val === \"object\";\r\n};\r\n\r\nconst camelizeRE = /-(\\w)/g;\r\n/**\r\n * @private\r\n * \u628A\u70E4\u8089\u4E32\u547D\u540D\u65B9\u5F0F\u8F6C\u6362\u6210\u9A7C\u5CF0\u547D\u540D\u65B9\u5F0F\r\n */\r\nexport const camelize = (str: string): string => {\r\n  return str.replace(camelizeRE, (_, c) => (c ? c.toUpperCase() : \"\"));\r\n};\r\n\r\nexport const extend = Object.assign;\r\n\r\nexport function hasChanged(value, oldValue) {\r\n  return !Object.is(value, oldValue);\r\n}\r\n\r\n/**\r\n * @private\r\n * \u9996\u5B57\u6BCD\u5927\u5199\r\n */\r\nexport const capitalize = (str: string) =>\r\n  str.charAt(0).toUpperCase() + str.slice(1);\r\n\r\n/**\r\n * @private\r\n * \u6DFB\u52A0 on \u524D\u7F00\uFF0C\u5E76\u4E14\u9996\u5B57\u6BCD\u5927\u5199\r\n */\r\nexport const toHandlerKey = (str: string) =>\r\n  str ? `on${capitalize(str)}` : ``;\r\n", "import { track, trigger } from './effect'\r\nimport {\r\n    reactive,\r\n    reactiveMap,\r\n    readonlyMap,\r\n    readonly,\r\n    shallowReadonlyMap,\r\n    ReactiveFlags\r\n} from './reactive'\r\nimport { isObject } from \"../../shared/index\";\r\n\r\nconst get = createGetter()\r\nconst set = createSetter()\r\nconst readonlyGet = createGetter(true)\r\nconst shallowReadonlyGet = createGetter(true, true)\r\n\r\n// \u662F\u5426\u53EA\u8BFB\uFF0C\u6D45\u5C42\r\nfunction createGetter(isReadonly = false, shallow = false) {\r\n    return function get(target, key, receiver) {\r\n        const isExistInReactiveMap = () =>\r\n            key === ReactiveFlags.RAW && receiver === reactiveMap.get(target)\r\n\r\n        const isExistInReadonlyMap = () =>\r\n            key === ReactiveFlags.RAW && receiver === readonlyMap.get(target)\r\n\r\n        const isExistInShallowReadonlyMap = () =>\r\n            key === ReactiveFlags.RAW && receiver == shallowReadonlyMap.get(target)\r\n\r\n        if (key === ReactiveFlags.IS_REACTIVE) {\r\n            return !isReadonly\r\n        } else if (key === ReactiveFlags.IS_READONLY) {\r\n            return isReadonly\r\n        } else if (\r\n            isExistInReactiveMap() ||\r\n            isExistInReadonlyMap() ||\r\n            isExistInShallowReadonlyMap()\r\n        ) {\r\n            return target\r\n        }\r\n\r\n        const res = Reflect.get(target, key, receiver)\r\n\r\n        if (shallow) {\r\n            return res\r\n        }\r\n\r\n        if (isObject(res)) {\r\n            return isReadonly ? readonly(res) : reactive(res)\r\n        }\r\n\r\n        if (!isReadonly) {\r\n            track(target, 'get', key)\r\n        }\r\n\r\n        return res\r\n    }\r\n}\r\n\r\nfunction createSetter() {\r\n    return function set(target, key, value, receiver) {\r\n        const result = Reflect.set(target, key, value, receiver)\r\n\r\n        // \u5728\u89E6\u53D1 set \u7684\u65F6\u5019\u8FDB\u884C\u89E6\u53D1\u4F9D\u8D56\r\n        trigger(target, \"get\", key)\r\n\r\n        return result\r\n    }\r\n}\r\n\r\nexport const mutableHandlers = {\r\n    get,\r\n    set\r\n}\r\n\r\nexport const readonlyHandlers = {\r\n    get: readonlyGet,\r\n    set(target, key) {\r\n        console.warn(\r\n            `readonly - ${String(key)} \u7684\u54CD\u5E94\u5F0F\u5BF9\u8C61\u4E0D\u53EF\u4EE5\u4FEE\u6539\u503C`,\r\n            target\r\n        )\r\n        return true\r\n    }\r\n}", "import {\r\n    mutableHandlers,\r\n    readonlyHandlers\r\n} from './baseHandlers'\r\n\r\nexport const reactiveMap = new WeakMap()\r\nexport const readonlyMap = new WeakMap()\r\nexport const shallowReadonlyMap = new WeakMap()\r\n\r\nexport const enum ReactiveFlags {\r\n    IS_REACTIVE = \"__v_isReactive\",\r\n    IS_READONLY = \"__v_isReadonly\",\r\n    RAW = \"__v_raw\"\r\n}\r\n\r\nexport function reactive(target) {\r\n    return createReactiveObject(target, reactiveMap, mutableHandlers)\r\n}\r\n\r\nexport function readonly(target) {\r\n    return createReactiveObject(target, reactiveMap, readonlyHandlers)\r\n}\r\n\r\nfunction createReactiveObject(target, proxyMap, baseHandlers) {\r\n    const existingProxy = proxyMap.get(target)\r\n    if (existingProxy) {\r\n        return existingProxy\r\n    }\r\n    const proxy = new Proxy(target, baseHandlers)\r\n    proxyMap.set(target, proxy)\r\n    return proxy\r\n}", "import { reactive } from './src/reactivity/src/index'\r\n\r\nconst obj = {\r\n    name: 'zhangsan'\r\n}\r\n\r\nconst proxy = reactive(obj)\r\n\r\nconst a = proxy.name\r\nproxy.name = 123\r\n\r\nconsole.log(proxy)\r\n"],
  "mappings": "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",
  "names": []
}
