{
  "version": 3,
  "sources": ["../src/shared/shapeFlags.ts", "../src/shared/index.ts", "../src/reactivity/src/effect.ts", "../main.ts"],
  "sourcesContent": ["// \u7EC4\u4EF6\u7684\u7C7B\u578B\r\nexport const enum ShapeFlags {\r\n    // \u6700\u540E\u8981\u6E32\u67D3\u7684 element \u7C7B\u578B\r\n    ELEMENT = 1,\r\n    // \u7EC4\u4EF6\u7C7B\u578B\r\n    STATEFUL_COMPONENT = 1 << 2,\r\n    // vnode \u7684 children \u4E3A string \u7C7B\u578B\r\n    TEXT_CHILDREN = 1 << 3,\r\n    // vnode \u7684 children \u4E3A\u6570\u7EC4\u7C7B\u578B\r\n    ARRAY_CHILDREN = 1 << 4,\r\n    // vnode \u7684 children \u4E3A slots \u7C7B\u578B\r\n    SLOTS_CHILDREN = 1 << 5\r\n}\r\n", "export * from \"./shapeFlags\";\r\n\r\nexport const isObject = (val) => {\r\n  return val !== null && typeof val === \"object\";\r\n};\r\n\r\nconst camelizeRE = /-(\\w)/g;\r\n/**\r\n * @private\r\n * \u628A\u70E4\u8089\u4E32\u547D\u540D\u65B9\u5F0F\u8F6C\u6362\u6210\u9A7C\u5CF0\u547D\u540D\u65B9\u5F0F\r\n */\r\nexport const camelize = (str: string): string => {\r\n  return str.replace(camelizeRE, (_, c) => (c ? c.toUpperCase() : \"\"));\r\n};\r\n\r\nexport const extend = Object.assign;\r\n\r\nexport function hasChanged(value, oldValue) {\r\n  return !Object.is(value, oldValue);\r\n}\r\n\r\n/**\r\n * @private\r\n * \u9996\u5B57\u6BCD\u5927\u5199\r\n */\r\nexport const capitalize = (str: string) =>\r\n  str.charAt(0).toUpperCase() + str.slice(1);\r\n\r\n/**\r\n * @private\r\n * \u6DFB\u52A0 on \u524D\u7F00\uFF0C\u5E76\u4E14\u9996\u5B57\u6BCD\u5927\u5199\r\n */\r\nexport const toHandlerKey = (str: string) =>\r\n  str ? `on${capitalize(str)}` : ``;\r\n", "import { createDep } from \"./dep\";\r\nimport { extend } from \"../../shared/index\";\r\n\r\nlet activeEffect = void 0;\r\nconst targetMap = new WeakMap();\r\n\r\n/**\r\n\r\nobject(\u5F15\u7528): {\r\n    key: dep || createDep() || Set()\r\n}\r\n\r\n\r\n**/\r\n\r\nexport function track(target, type, key) {\r\n\tlet depsMap = targetMap.get(target);\r\n\tif (!depsMap) {\r\n\t\tconsole.log(\"\u8BBE\u7F6E\");\r\n\t\tdepsMap = new Map();\r\n\t\ttargetMap.set(target, depsMap);\r\n\t}\r\n\r\n\tlet dep = depsMap.get(key);\r\n\r\n\tif (!dep) {\r\n\t\tdep = createDep();\r\n\t\tdepsMap.set(key, dep);\r\n\t}\r\n\r\n\ttrackEffects(dep);\r\n}\r\n\r\nexport function trackEffects(dep) {\r\n\tif (!activeEffect) return;\r\n\r\n\tdep.add(activeEffect);\r\n\r\n\t(activeEffect as any).deps.push(dep);\r\n}\r\n\r\nexport function isTracking() {\r\n\treturn activeEffect !== undefined;\r\n}\r\n\r\nexport function trigger(target, type, key) {\r\n\tlet deps: Array<any> = [];\r\n\r\n\tconst depsMap = targetMap.get(target);\r\n\r\n\tconsole.log(targetMap);\r\n\r\n\tconst dep = depsMap.get(key);\r\n\r\n\tdeps.push(dep);\r\n\r\n\tconst effects: Array<any> = [];\r\n\r\n\tdeps.forEach((dep) => {\r\n\t\teffects.push(...dep);\r\n\t});\r\n\r\n\ttriggerEffects(createDep(effects));\r\n}\r\n\r\nexport function triggerEffects(dep) {\r\n\tfor (const effect of dep) {\r\n\t\tif (effect.scheduler) {\r\n\t\t\t// scheduler \u53EF\u4EE5\u8BA9\u7528\u6237\u81EA\u5DF1\u9009\u62E9\u8C03\u7528\u7684\u5B9E\u9645\r\n\t\t\t// \u8FD9\u6837\u5C31\u53EF\u4EE5\u7075\u6D3B\u7684\u63A7\u5236\u8C03\u7528\r\n\t\t\t// TODO: runtime-core next ticker\r\n\t\t\teffect.scheduler();\r\n\t\t} else {\r\n\t\t\teffect.run();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// \u7528\u4E8E\u4F9D\u8D56\u6536\u96C6\r\nexport class ReactiveEffect {\r\n\tactive = true;\r\n\tdeps = [];\r\n\tpublic onStop?: () => void;\r\n\tconstructor(public fn, public scheduler?) {\r\n\t\tconsole.log(\"\u521B\u5EFA ReactiveEffect \u5BF9\u8C61\");\r\n\t}\r\n\r\n\trun() {\r\n\t\t// \u6267\u884C\u7684\u65F6\u5019\u7ED9\u5168\u5C40\u7684 activeEffect \u8D4B\u503C\r\n\t\t// \u5229\u7528\u5168\u5C40\u5C5E\u6027\u6765\u83B7\u53D6\u5F53\u524D\u7684 effect\r\n\t\tactiveEffect = this as any;\r\n\t\t// \u6267\u884C\u7528\u6237\u4F20\u5165\u7684 fn\r\n\t\tconsole.log(\"\u6267\u884C\u7528\u6237\u4F20\u5165\u7684 fn\");\r\n\t\treturn this.fn();\r\n\t}\r\n\r\n\tstop() {\r\n\t\tif (this.active) {\r\n\t\t\t// \u5982\u679C\u7B2C\u4E00\u6B21\u6267\u884C stop \u540E active \u5C31 false \u4E86\r\n\t\t\t// \u4E3A\u4E86\u9632\u6B62\u91CD\u590D\u7684\u8C03\u7528\uFF0C\u6267\u884C stop \u903B\u8F91\r\n\t\t\tcleanupEffect(this);\r\n\t\t\tif (this.onStop) {\r\n\t\t\t\t// TODO: \u54EA\u91CC\u6765\u4F20\u5165\u8D4B\u503C\u7684 onStop\r\n\t\t\t\tthis.onStop();\r\n\t\t\t}\r\n\t\t\tthis.active = false;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function effect(fn, options = {}) {\r\n\t// TODO:\r\n\tconst _effect = new ReactiveEffect(fn);\r\n\r\n\t// \u628A\u7528\u6237\u4F20\u8FC7\u6765\u7684\u503C\u5408\u5E76\u5230 _effect \u5BF9\u8C61\u4E0A\u53BB\r\n\t// \u7F3A\u70B9\u5C31\u662F\u4E0D\u662F\u663E\u5F0F\u7684\uFF0C\u770B\u4EE3\u7801\u7684\u65F6\u5019\u5E76\u4E0D\u77E5\u9053\u6709\u4EC0\u4E48\u503C\r\n\textend(_effect, options);\r\n\t_effect.run();\r\n\r\n\t// \u628A _effect.run \u8FD9\u4E2A\u65B9\u6CD5\u8FD4\u56DE\r\n\t// \u8BA9\u7528\u6237\u53EF\u4EE5\u81EA\u884C\u9009\u62E9\u8C03\u7528\u7684\u65F6\u673A\uFF08\u8C03\u7528 fn\uFF09\r\n\tconst runner: any = _effect.run.bind(_effect);\r\n\trunner.effect = _effect;\r\n\treturn runner;\r\n}\r\n\r\nfunction cleanupEffect(effect: ReactiveEffect) {\r\n\t// \u627E\u5230\u6240\u6709\u4F9D\u8D56 \u8FD9\u4E2A effect \u7684\u76F8\u5E94\u5F0F\u5BF9\u8C61\r\n\t// \u4ECE\u8FD9\u4E9B\u76F8\u5E94\u5F0F\u5BF9\u8C61\u91CC\u9762\u628A effect \u7ED9\u5220\u9664\u6389\r\n\teffect.deps.forEach((dep: Set<ReactiveEffect>) => {\r\n\t\tdep.delete(effect);\r\n\t});\r\n\teffect.deps.length = 0;\r\n}\r\n", "// import { createApp } from \"./src/runtime-core/index\";\r\n// import App from \"./App\";\r\n\r\n// console.log(123);\r\n// const app = createApp(App);\r\n\r\n// app.mount(document.querySelector(\"#app\"));\r\n\r\nimport { effect } from \"./src/reactivity/src/effect\";\r\n\r\nconst myEffect = effect(\r\n\tfunction () {\r\n\t\tconsole.log(123456789);\r\n\t},\r\n\t{\r\n\t\tscheduler: () => {\r\n\t\t\tconsole.log(this);\r\n\t\t},\r\n\t\ttest: function () {\r\n\t\t\tconsole.log(this);\r\n\t\t},\r\n\t\tonStop() {\r\n\t\t\tconsole.log(\"----- \u5173\u95ED\u7684\u65F6\u5019\u4F1A\u6267\u884C\u8FD9\u4E2A\");\r\n\t\t},\r\n\t}\r\n);\r\n\r\nconsole.log(myEffect);\r\nconsole.log(myEffect.effect);\r\nconsole.log(\"\u518D\u6267\u884C\u4E00\u6B21----\");\r\nmyEffect();\r\n\r\nmyEffect.effect.onStop();\r\nmyEffect.effect.onStop();\r\nmyEffect.effect.onStop();\r\nmyEffect.effect.onStop();\r\nmyEffect.effect.onStop();\r\n"],
  "mappings": ";;AACO,MAAW;AAAX,YAAW,aAAX;AAEH,yCAAU,KAAV;AAEA,oDAAqB,KAArB;AAEA,+CAAgB,KAAhB;AAEA,gDAAiB,MAAjB;AAEA,gDAAiB,MAAjB;AAAA,KAVc;;;ACcX,MAAM,SAAS,OAAO;;;ACZ7B,MAAI,eAAe;AACnB,MAAM,YAAY,IAAI;AA2Ef,6BAAqB;AAAA,IAI3B,YAAmB,IAAW,WAAY;AAAvB;AAAW;AAH9B,oBAAS;AACT,kBAAO;AAGN,cAAQ,IAAI;AAAA;AAAA,IAGb,MAAM;AAGL,qBAAe;AAEf,cAAQ,IAAI;AACZ,aAAO,KAAK;AAAA;AAAA,IAGb,OAAO;AACN,UAAI,KAAK,QAAQ;AAGhB,sBAAc;AACd,YAAI,KAAK,QAAQ;AAEhB,eAAK;AAAA;AAEN,aAAK,SAAS;AAAA;AAAA;AAAA;AAKV,kBAAgB,IAAI,UAAU,IAAI;AAExC,UAAM,UAAU,IAAI,eAAe;AAInC,WAAO,SAAS;AAChB,YAAQ;AAIR,UAAM,SAAc,QAAQ,IAAI,KAAK;AACrC,WAAO,SAAS;AAChB,WAAO;AAAA;AAGR,yBAAuB,SAAwB;AAG9C,YAAO,KAAK,QAAQ,CAAC,QAA6B;AACjD,UAAI,OAAO;AAAA;AAEZ,YAAO,KAAK,SAAS;AAAA;;;AC1HtB,MAAM,WAAW,OAChB,WAAY;AACX,YAAQ,IAAI;AAAA,KAEb;AAAA,IACC,WAAW,MAAM;AAChB,cAAQ,IAAI;AAAA;AAAA,IAEb,MAAM,WAAY;AACjB,cAAQ,IAAI;AAAA;AAAA,IAEb,SAAS;AACR,cAAQ,IAAI;AAAA;AAAA;AAKf,UAAQ,IAAI;AACZ,UAAQ,IAAI,SAAS;AACrB,UAAQ,IAAI;AACZ;AAEA,WAAS,OAAO;AAChB,WAAS,OAAO;AAChB,WAAS,OAAO;AAChB,WAAS,OAAO;AAChB,WAAS,OAAO;",
  "names": []
}
